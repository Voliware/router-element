class RouteElement extends HTMLElement{constructor(){super(),this.is_initialized=!1,new MutationObserver(t=>{t.forEach(t=>{switch(t.type){case"attributes":if("url"===t.attributeName){const e=new CustomEvent("route.urlchanged",{detail:t.oldValue,bubbles:!0});this.dispatchEvent(e)}else"nav"===t.attributeName&&this.findNavs()}})}).observe(this,{attributes:!0,attributeOldValue:!0,attributeFilter:["url","nav"]})}init(){this.is_initialized||(this.is_initialized=!0,this.initialize())}initialize(){}toggle(t){const e=this.getAttribute("display")||"block";this.style.display=t?e:"none"}}customElements.define("route-element",RouteElement);class RouterElement extends HTMLElement{static route(t,e){t.dispatchEvent(new CustomEvent("router.route",{detail:e,bubbles:!0}))}constructor(){super(),this.history_allowed="file:"!==window.location.protocol,this.routes=new Map,this.navs=new Map,this.current_url=null,new MutationObserver(t=>{t.forEach(t=>{switch(t.type){case"childList":t.removedNodes.length&&this.handleRemovedChildNode(t.removedNodes)}})}).observe(this,{childList:!0}),this.addEventListener("router.route",t=>{this.route(t.detail)})}connectedCallback(){"false"!==this.getAttribute("back")&&window.addEventListener("popstate",()=>{this.route(window.location.pathname,{add_to_history:!1})}),this.findRoutes(),this.findNavs(),"false"!==this.getAttribute("auto")&&this.initialize()}initialize(){this.route(window.location.pathname,{add_to_history:!1})}handleRemovedChildNode(t){for(let e=0;e<t.length;e++)if(this.current_url===t[e].getAttribute("url")){this.current_url=null,this.dispatchEvent(new Event("router.removed",{bubbles:!0}));break}}findNavs(){this.navs.clear();const t=this.getAttribute("nav");if(!t)return;const e=document.querySelectorAll(t);e.length&&e.forEach(t=>{t.querySelectorAll(".route-element-nav").forEach(t=>{const e=t.getAttribute("href"),i=t.getAttribute("url"),s=e||i;if(!s)return void console.warn("route-element-nav is missing an href/url attribute");t.addEventListener("click",t=>{t.preventDefault(),this.route(s)});const r=this.navs.get(s)||[];r.push(t),this.navs.set(s,r)})})}setNav(t){const e=this.navs.get(this.current_url);e&&e.length&&e.forEach(t=>{t.classList.remove("route-element-nav-active")});const i=this.navs.get(t);i&&i.length&&i.forEach(t=>{t.classList.toggle("route-element-nav-active",!0)})}findRoutes(){this.routes.clear();for(let t=0;t<this.children.length;t++){const e=this.children[t];e instanceof RouteElement&&(this.routes.set(e.getAttribute("url"),e),e.addEventListener("route.urlchanged",({detail:t})=>{this.current_url===t&&(this.current_url=null)}))}}route(t,{add_to_history:e=!0}={}){if("string"!=typeof t)return void console.warn("Invalid URL passed to route()");let i=t;const s=i.indexOf("?");s>-1&&(i=i.slice(0,s)),e&&this.history_allowed&&"false"!==this.getAttribute("history")&&window.history.pushState(null,null,t);const r=this.setRoute(i),n=r?"router.routed":"router.notfound";this.dispatchEvent(new CustomEvent(n,{detail:r||i,bubbles:!0}))}setRoute(t){let e=this.routes.get(t);if(!e&&"false"!==this.getAttribute("partial")){let i="";this.routes.forEach((e,s)=>{t.includes(s)&&s.length>i.length&&(i=s)}),i&&(t=i,e=this.routes.get(t))}if(!e)return"";if(null!==this.current_url){const t=this.routes.get(this.current_url);t&&t.toggle(!1)}return this.setNav(t),e.toggle(!0),e.init(),this.current_url=t,this.current_url}}customElements.define("router-element",RouterElement);